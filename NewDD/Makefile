#--------------------------------------------------
#--- Makefile for NewDD
#--- Generated by ../configure
#--------------------------------------------------

#--------------------------------------------------
# Compiler settings (configured by ../configure)
#--------------------------------------------------
CC = mpiicx
OPT = -g -DNENER=0 -DNPRE=8 -DNMEG=20000 -DWGROUPSIZE=5  -DUSE_MPI -DQUADHILBERT -DREAD_SINK -DNCHEM=9 -DNDUST=4 -DDEBUG=1 -DLOG=1
FORMAT_OPT ?=
OPT += $(FORMAT_OPT)

RANLIB = ranlib

CFLAGS = $(OPT)
CCLAGS = $(OPT)

LIBS       = libmyram.a

TIMEROBJ       = rd_amr.o  rd_info.o  rd_part.o header.o utils.o Memory2.o find_leaf_gas.o rd_hydro.o rd_sink.o

NEWDD	= newdd.exe
NEWDDOBJ	= newdd.o

INCLUDES = -I./ -I../
HDF5_DIR ?= /usr/local
HDF5_INC = -I$(HDF5_DIR)/include
HDF5_LIB = -L$(HDF5_DIR)/lib -lhdf5

ifneq (,$(findstring -DGADGET_HDF5,$(OPT)))
TIMEROBJ += rd_gadget.o
INCLUDES += $(HDF5_INC)
endif

default:
	$(MAKE) $(LIBS)
	$(RANLIB) $(LIBS)

all:
	$(MAKE) $(LIBS)
	$(MAKE) $(NEWDDOBJ)
	$(MAKE) $(NEWDD)

new:
	$(MAKE) clean
	$(MAKE) $(LIBS)

newdd:
	-rm -f newdd.exe
	$(MAKE) $(NEWDDOBJ)
	$(MAKE) $(NEWDD)

$(LIBS): $(TIMEROBJ)
	ar -rcv $@ $?
	ranlib $@

OSTLIB = -L. -lmyram  -L/home/kjhan/local/lib -lm
ifneq (,$(findstring -DGADGET_HDF5,$(OPT)))
OSTLIB += $(HDF5_LIB)
endif

%.c:
	$(CC) $(CFLAGS) -c $*.c

clean:
	-rm -f *.o *.a *.d core  *.exe

#--- Suffix-based compilation rules
.SUFFIXES: .exe .o .c

#rules to build binary from source

.c.o :
	$(CC) $(CFLAGS) $(INCLUDES) -c $<

.c.exe :
	$(CC) $(CFLAGS) $(LDFLAGS) $(INCLUDES) -o $*.exe $(NEWDDOBJ) $(OSTLIB)
