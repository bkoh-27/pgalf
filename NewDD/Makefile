#--------------------------------------------------
#--- Makefile for NewDD
#--- Generated by ../configure
#--------------------------------------------------

#--------------------------------------------------
# Compiler settings (configured by ../configure)
#--------------------------------------------------
CC = mpiicx
OPT = -g -DNENER=0 -DNPRE=8 -DNMEG=20000 -DWGROUPSIZE=5  -DUSE_MPI -DQUADHILBERT -DREAD_SINK -DNCHEM=9 -DNDUST=4 -DDEBUG=1 -DLOG=1 -DGADGET_HDF5

RANLIB = ranlib

CFLAGS = $(OPT)
CCLAGS = $(OPT)

LIBS       = libmyram.a

TIMEROBJ       = rd_amr.o  rd_info.o  rd_part.o header.o utils.o Memory2.o find_leaf_gas.o rd_hydro.o rd_sink.o rd_gadget.o

NEWDD	= newdd.exe
NEWDDOBJ	= newdd.o

HDF5_INC = /home/bkoh/miniconda3/envs/pgalf/include
HDF5_LIB = /home/kjhan/local/lib

INCLUDES = -I./ -I../ -I$(HDF5_INC)

default:
	$(MAKE) $(LIBS)
	$(RANLIB) $(LIBS)

all:
	$(MAKE) $(LIBS)
	$(MAKE) $(NEWDDOBJ)
	$(MAKE) $(NEWDD)

new:
	$(MAKE) clean
	$(MAKE) $(LIBS)

newdd:
	-rm -f newdd.exe
	$(MAKE) $(NEWDDOBJ)
	$(MAKE) $(NEWDD)

$(LIBS): $(TIMEROBJ)
	ar -rcv $@ $?
	ranlib $@

OSTLIB = -L. -lmyram  -L$(HDF5_LIB) -lhdf5 -Wl,-rpath,$(HDF5_LIB) -lm

%.c:
	$(CC) $(CFLAGS) -c $*.c

clean:
	-rm -f *.o *.a *.d core  *.exe

#--- Suffix-based compilation rules
.SUFFIXES: .exe .o .c

#rules to build binary from source

.c.o :
	$(CC) $(CFLAGS) $(INCLUDES) -c $<

.c.exe :
	$(CC) $(CFLAGS) $(LDFLAGS) $(INCLUDES) -o $*.exe $(NEWDDOBJ) $(OSTLIB)
